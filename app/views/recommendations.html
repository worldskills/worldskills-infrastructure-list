<ol class="breadcrumb">
    <li><a ui-sref="eventList" translate>EVENTS</a></li>
    <li><a ui-sref="event({eventId: event.id})">{{event.name.text}}</a></li>
    <li class="active" translate>RECOMMENDATIONS</li>
</ol>

<h1 class="h2" translate>RECOMMENDATIONS</h1>

<form class="form-inline">
  <div class="form-group">
    <select class="form-control input-sm" ng-model="listId" ng-change="updateListId()">
        <option value=""></option>
        <option ng-repeat="list in lists" value="{{list.id}}">{{list.name.text}}</option>
    </select>
  </div>
</form>

<ws-spinner ng-if="loading.recommendations" class="bigSpinner"></ws-spinner>

<div ng-if="recommendedItems.length == 0">
  <br>
  <div class="alert alert-warning" translate>RECOMMENDATIONS_NO_ITEM</div>
</div>

    <div class="panel panel-validation-view" style="margin-top:20px;" ng-if="recommendedItems.length > 0">
        <div class="table-responsive table-validation bordered">
            <table class="table table-condensed table-bordered il-public-items-table">
                <thead>
                    <tr>
                        <th class="col-15" translate>LIST</th>
                        <th class="col-15" translate>TH_CATEGORY</th>
                        <th class="col-15" translate>TH_ITEM_APPLICANT</th>
                        <th class="col-20" translate>TH_ITEM_DATE_AND_TIME</th>
                        <th class="col-15" translate>NAME</th>
                        <th class="col-15" translate>ACTION</th>
                        <th class="col-15" translate>ACTIONS</th>
                    </tr>
                </thead>
            </table>
        </div>
    </div>

    <div class="panel panel-validation-view" ng-repeat="item in recommendedItems">
        <div class="panel-heading">
            <div class="table-responsive table-validation">
                <table class="table table-condensed table-bordered il-public-items-table">
                    <tbody>
                        <tr>
                            <td class="col-15">
                                <span class="ng-binding">{{item.list.name.text}}</span>
                            </td>
                            <td class="col-15">
                                <span class="ng-binding ng-scope">{{ item.category.name.text }}</span>
                            </td>
                            <td class="col-15">{{item.person.first_name}} {{item.person.last_name}}</td>
                            <td class="col-20">
                                <span class="ng-binding ng-scope" ng-if="item.recommendedAt" ng-bind-html="'DATE_TIME_AT' | translate: {date: (item.recommendedAt | amDateFormat: 'DD.MM.YYYY'), time: (item.recommendedAt | amDateFormat: 'HH:mm')}"></span>
                            </td>
                            <td class="col-15">{{item.description.text}}</td>
                            <td class="col-15">
                              <span ng-if="item.requestedItem && !item.deletionSuggestion" translate>TD_ITEM_REPLACE_WITH</span>
                              <span ng-if="!item.requestedItem" translate>TD_ITEM_ADDITION</span>
                              <span ng-if="item.deletionSuggestion" translate>TD_ITEM_DELETION</span>
                              <span ng-if="item.recommendedItemSupplied">
                                &nbsp;<i class='glyphicon glyphicon-exclamation-sign blue' tooltip-placement="bottom" uib-tooltip="{{'SUPPLIED_ITEM_CHANGED' | translate}}"></i>
                              </span>
                            </td>
                            <td class="col-15">
                                <button ng-click="review(item)" class='btn btn-primary btn-sm'><i class="fa fa-info-circle"></i></button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div id="validation{{item.id}}" class="panel-body collapse" role="tabpanel" aria-labelledby="headingOne">
            <div class="table-container table-responsive">
                <table class="table table-condensed table-bordered il-public-items-table table-in-validation">
                    <thead>
                        <tr>
                            <th class="col-10"></th>
                            <th class="col-15" translate>DESCRIPTION</th>
                            <th class="col-10" translate>QUANTITY</th>
                            <th class="col-10" translate>ADDITIONAL_QUANTITY</th>
                            <th class="col-10" translate>UNIT</th>
                            <th class="col-15" translate>POTENTIAL_SUPPLIER</th>
                            <th class="col-10 text-center" translate>WRONG_SUPPLIED_ITEM</th>
                            <th class="col-5" translate>COMMENT</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="actuel" ng-if="item.requestedItem">
                            <td>
                                <span ng-if="!item.deletionSuggestion" translate>TD_ITEM_CURRENT</span>
                                <span ng-if="item.deletionSuggestion" translate>TD_ITEM_DELETION</span>
                            </td>
                            <td ng-class="{'change': item.description.text != item.requestedItem.description.text}">
                                {{item.requestedItem.description.text}}
                            </td>
                            <td ng-class="{'change': item.quantity != item.requestedItem.quantity}">
                                {{'ITEM_READABLE_QUANTITY_' + item.requestedItem.multiplier | translate: {quantity: item.requestedItem.quantity, factor: item.requestedItem.multiply_factor} }}
                            </td>
                            <td ng-class="{'change': item.additional_quantity != item.requestedItem.additional_quantity}">
                                {{item.requestedItem.additional_quantity}}
                            </td>
                            <td ng-class="{'change': item.unit != item.requestedItem.unit}">
                                {{item.requestedItem.unit}}
                            </td>
                            <td ng-class="{'change': item.potentialSupplier != item.requestedItem.supplier}">
                                {{item.requestedItem.supplier.name}}
                            </td>
                            <td rowspan="2" class="text-center" translate>
                                {{item.wrongSuppliedItem+"Label"}}
                            </td>
                            <td rowspan="2" class="description">
                              {{item.comment}}
                            </td>
                            <td ng-if="false" rowspan="2" class="image text-center text-center">
                              <!-- deactived temporarily -->
                                <div class="aniimated-thumbnials lightgallery-validation lightgallery">
                                </div>
                            </td>
                        </tr>

                        <tr class="remplace" ng-if="!item.deletionSuggestion">
                            <td>
                                <span ng-if="item.requestedItem" translate>
                                    TD_ITEM_REPLACE_WITH
                                </span>
                                <span ng-if="!item.requestedItem" translate>
                                    TD_ITEM_ADDITION
                                </span>
                            </td>
                            <td ng-class="{'change-error': item.description.text != item.requestedItem.description.text}">
                                {{item.description.text}}
                            </td>
                            <td ng-class="{'change-warning': item.quantity != item.requestedItem.quantity}">
                                {{'ITEM_READABLE_QUANTITY_' + item.multiplier | translate: {quantity: item.quantity, factor: item.multiplyFactor} }}
                            </td>
                            <td ng-class="{'change-warning': item.additional_quantity != item.requestedItem.additional_quantity}">
                                {{item.additional_quantity}}
                            </td>
                            <td ng-class="{'change-warning': item.unit != item.requestedItem.unit}">
                                {{item.unit}}
                            </td>
                            <td ng-class="{'change-warning': item.potentialSupplier != item.requestedItem.supplier}">
                                {{item.potentialSupplier.name}}
                            </td>
                            <td class="text-center" ng-if="!item.requestedItem" translate>
                                {{item.wrongSuppliedItem}}
                            </td>
                            <td rowspan="2" class="description" ng-if="!item.requestedItem">{{item.comment}}</td>
                        </tr>
                    </tbody>
                </table>

                <div class="button-group">
                    <button type="button" ng-click="accept(item);" class="pull-right btn btn-sm btn-success">
                        <span translate>ACCEPT</span>
                    </button>

                    <button type="button" class="pull-right btn btn-sm btn-danger"  ng-click="reject(item);">
                        <span translate>REJECT</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

<br/>
